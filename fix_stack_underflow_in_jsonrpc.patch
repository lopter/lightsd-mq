# HG changeset patch
# User Xavier Deguillard <deguilx@gmail.com>
# Parent  a7efed63bc95fd9efac9dbb43cbdf93e1064fe9b
Fix stack underflow in jsonrpc

diff --git a/core/jsonrpc.c b/core/jsonrpc.c
--- a/core/jsonrpc.c
+++ b/core/jsonrpc.c
@@ -400,7 +400,7 @@
     }
 
     for (int si = 0; si != schema_size; si++) {
-        if (!schema[si].optional) {
+        if (!schema[si].optional && schema[si].value_offset != -1) {
             const jsmntok_t *seen = LGTD_JSONRPC_GET_JSMNTOK(
                 output, schema[si].value_offset
             );
