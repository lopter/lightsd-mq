# HG changeset patch
# Parent  ec8c5840194101c507ce3e155d1dc7c5d719bd62
Cope with versions of CMake older than 2.8.11

diff --git a/CMakeLists.txt b/CMakeLists.txt
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -1,5 +1,5 @@
-# first version with TARGET_INCLUDE_DIRECTORIES:
-CMAKE_MINIMUM_REQUIRED(VERSION 2.8.11)
+# it probably works with older versions but this the oldest tested one:
+CMAKE_MINIMUM_REQUIRED(VERSION 2.8.9)
 
 PROJECT(LIGHTSD C)
 
@@ -87,7 +87,16 @@
 ADD_SUBDIRECTORY(compat)
 ADD_SUBDIRECTORY(core)
 ADD_SUBDIRECTORY(lifx)
-ADD_SUBDIRECTORY(tests)
+# 2.8.11 is the first version with TARGET_INCLUDE_DIRECTORIES:
+IF (CMAKE_VERSION VERSION_GREATER 2.8.10)
+    ADD_SUBDIRECTORY(tests)
+ELSE ()
+    MESSAGE(
+        STATUS
+        "The tests suite requires CMake >= 2.8.11 "
+        "but you have ${CMAKE_VERSION}, disabling it"
+    )
+ENDIF ()
 
 INSTALL(
     FILES COPYING README.rst docs/protocol.rst
diff --git a/README.rst b/README.rst
--- a/README.rst
+++ b/README.rst
@@ -65,8 +65,8 @@
 written in C with reasonable dependencies:
 
 - libevent ≥ 2.0.19 (released May 2012);
-- CMake ≥ 2.8.11 (released May 2013): only if you want to build lightsd from its
-  sources.
+- CMake ≥ 2.8.9 (released August 2012): only if you want to build lightsd from
+  its sources.
 
 lightsd is actively developed and tested from Arch Linux, Debian and Mac OS X;
 both for 32/64 bits and little/big endian architectures.
diff --git a/docs/installation.rst b/docs/installation.rst
--- a/docs/installation.rst
+++ b/docs/installation.rst
@@ -70,7 +70,7 @@
 you have the following requirements installed:
 
 - libevent ≥ 2.0.19 (released May 2012);
-- CMake ≥ 2.8.11 (released May 2013).
+- CMake ≥ 2.8.9 (released August 2012).
 
 lightsd is developed and tested from Arch Linux, Debian and Mac OS X; both for
 32/64 bits and little/big endian architectures.
